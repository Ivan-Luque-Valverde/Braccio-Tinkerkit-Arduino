# Configuración del Sistema de Visión para Braccio
# Parámetros de calibración y detección de objetos

# Configuración de la cámara
camera:
  name: "overhead_camera"
  topic_image: "/overhead_camera/image_raw"
  topic_camera_info: "/overhead_camera/camera_info"
  frame_id: "overhead_camera_optical_frame"
  
  # Parámetros intrínsecos (calculados basados en FOV=60° y resolución 640x480)
  width: 640
  height: 480
  fx: 554.382713          # Focal length x (calculado: width/2 / tan(FOV/2))
  fy: 554.382713          # Focal length y (igual a fx para píxeles cuadrados)
  cx: 320.0               # Center x (width/2)
  cy: 240.0               # Center y (height/2)

# Configuración del workspace de detección
workspace:
  # Límites en coordenadas de la cámara (metros)
  x_min: -0.4
  x_max: 0.6
  y_min: -0.4
  y_max: 0.4
  z_table: 0.0   # Altura del suelo de Gazebo (los objetos están en z=0)
  
  # Transformación cámara -> mundo (CONFIGURACIÓN ESTABLE)
  camera_height: 0.6      # Altura de la cámara sobre el workspace (coincide con posición física)
  camera_offset_x: 0.15   # Offset para centrar en base del robot
  camera_offset_y: 0.0    # Offset Y
  
  # Factores de corrección para transformación de coordenadas
  coordinate_scale_x: 2.5    # Escala para coordenadas X (valor estable)
  coordinate_scale_y: 2.5    # Escala para coordenadas Y (valor estable)
  coordinate_rotation: 0.0   # Sin rotación adicional

# Configuración de detección de objetos
object_detection:
  # Detección por color HSV
  red_object:
    enabled: false
    hsv_lower: [0, 120, 70]      # [H_min, S_min, V_min]
    hsv_upper: [10, 255, 255]    # [H_max, S_max, V_max]
    min_area: 100                # Área mínima en píxeles
    max_area: 5000               # Área máxima en píxeles
    
  green_object:
    enabled: true
    hsv_lower: [40, 40, 40]      # [H_min, S_min, V_min] - Rango amplio para detectar verde
    hsv_upper: [85, 255, 255]    # [H_max, S_max, V_max] - Abarca desde verde oscuro a claro
    min_area: 100                # Área mínima en píxeles
    max_area: 5000               # Área máxima en píxeles
    
  blue_object:
    enabled: false
    hsv_lower: [100, 120, 70]    # [H_min, S_min, V_min]
    hsv_upper: [130, 255, 255]   # [H_max, S_max, V_max]
    min_area: 100                # Área mínima en píxeles
    max_area: 5000               # Área máxima en píxeles

# Filtros de procesamiento de imagen
image_processing:
  blur_kernel_size: 5           # Tamaño del kernel de blur
  erosion_iterations: 2         # Iteraciones de erosión
  dilation_iterations: 2        # Iteraciones de dilatación
  contour_approximation: 0.02   # Factor de aproximación de contornos

# Configuración de coordenadas
coordinate_mapping:
  # USAR TRANSFORMACIÓN BÁSICA - más simple y directa
  use_automatic_calibration: false  # Cambiar a false para usar calibración manual
  
  # Calibración manual optimizada para Braccio (VALORES ESTABLES)
  pixels_per_meter_x: 2000      # Píxeles por metro en X (valor que funcionaba)
  pixels_per_meter_y: 2000      # Píxeles por metro en Y (valor que funcionaba)
  origin_pixel_x: 320           # Píxel origen en X (centro de imagen)
  origin_pixel_y: 240           # Píxel origen en Y (centro de imagen)

# Configuración de publicación
publishing:
  # Topics de salida
  detected_objects_topic: "/vision/detected_objects"
  debug_image_topic: "/vision/debug_image"
  object_markers_topic: "/vision/object_markers"
  
  # Frecuencia de publicación
  detection_rate: 10.0          # Hz
  debug_image_rate: 5.0         # Hz

# Configuración de debugging
debug:
  show_detection_windows: false  # Mostrar ventanas de OpenCV (solo para desarrollo)
  save_debug_images: false      # Guardar imágenes de debug
  verbose_logging: true         # Logging detallado
  draw_workspace_bounds: true   # Dibujar límites del workspace en imagen debug

# Configuración de pick and place con visión
vision_pick_and_place:
  # Prioridades de objetos (orden de pick)
  object_priority: ["red_object", "green_object", "blue_object"]
  
  # Posiciones de destino para cada tipo de objeto
  target_positions:
    red_object: [-0.3, 0.0]     # [x, y] en metros
    green_object: [-0.2, 0.2]   # [x, y] en metros  
    blue_object: [-0.3, -0.2]   # [x, y] en metros
  
  # Configuración de aproximación
  approach_offset_z: 0.1        # Altura sobre el objeto para aproximación
  pick_offset_z: 0.02           # Altura sobre el objeto para pick
  
  # Tolerancias
  position_tolerance: 0.02      # Tolerancia de posición en metros
  detection_confidence: 0.8     # Confianza mínima para considerar detección válida
